# Generate Namespace Client Script

This script automatically generates Terraform provider client code for Nutanix API namespaces based on the `sdk_info.json` file generated by `extract_sdk_info.go`.

## Usage

```bash
go run -mod=mod scripts/generate_namespace_client.go \
  -json <path-to-sdk_info.json> \
  -output-dir <output-directory>
```

### Parameters

- `-json`: Path to the `sdk_info.json` file (default: `./sdk_extract_output/sdk_info.json`)
- `-output-dir`: Output directory where namespace directories will be created (default: `./nutanix/sdks/v4`)

### Example

```bash
# Generate client for monitoring namespace
go run -mod=mod scripts/generate_namespace_client.go \
  -json scripts/sdk_extract_output/sdk_info.json \
  -output-dir nutanix/sdks/v4
```

## What it does

1. **Reads `sdk_info.json`**: Parses the JSON file to extract API information
2. **Extracts namespace**: Derives the namespace from the package path (e.g., `monitoring-go-client` â†’ `monitoring`)
3. **Identifies API types**: Finds all unique API client types from the method receivers
4. **Creates directory structure**: Creates `nutanix/sdks/v4/{namespace}/` if it doesn't exist
5. **Generates client code**: Creates `{namespace}.go` with:
   - Package declaration
   - Imports for API and client packages
   - `Client` struct with all API instances
   - `New{Namespace}Client` function for initialization
6. **Formats code**: Automatically formats the generated code using `gofmt`

## Generated File Structure

The generated file follows this pattern:

```go
package {namespace}

import (
	"github.com/nutanix/ntnx-api-golang-clients/{namespace}-go-client/v4/api"
	{namespace} "github.com/nutanix/ntnx-api-golang-clients/{namespace}-go-client/v4/client"
	"github.com/terraform-providers/terraform-provider-nutanix/nutanix/client"
)

type Client struct {
	// All API client instances
	APIClientInstance *{namespace}.ApiClient
}

func New{Namespace}Client(credentials client.Credentials) (*Client, error) {
	// Client initialization logic
}
```

## Workflow

1. **Extract SDK info**: First run `extract_sdk_info.go` to generate `sdk_info.json`:
   ```bash
   go run scripts/extract_sdk_info.go \
     -package github.com/nutanix/ntnx-api-golang-clients/{namespace}-go-client/v4@v{version} \
     -api-package {namespace}
   ```

2. **Generate namespace client**: Then run this script to generate the client code:
   ```bash
   go run -mod=mod scripts/generate_namespace_client.go \
     -json scripts/sdk_extract_output/sdk_info.json \
     -output-dir nutanix/sdks/v4
   ```

## Notes

- The script automatically creates the namespace directory if it doesn't exist
- Generated code is automatically formatted using `gofmt`
- The script extracts unique API types from method receivers ending with `Api`
- Field names are automatically generated from API type names

